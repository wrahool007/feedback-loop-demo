<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Feed Loop Quest - Algorithmic Fairness Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --black: #000000;
            --white: #ffffff;
            --grey-light: #cfcfcf;
            --grey-mid: #888888;
            --grey-dark: #333333;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background-color: var(--black);
            color: var(--white);
            font-family: var(--font-family);
            font-size: 16px;
            line-height: 1.5;
            overflow-x: hidden;
        }

        header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--grey-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .header-content {
            text-align: center;
            flex: 1;
            min-width: 200px;
        }

        h1 {
            font-size: clamp(1.3rem, 5vw, 1.8rem);
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .subtitle {
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            color: var(--grey-mid);
        }

        .people-counter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1rem;
            background-color: var(--grey-dark);
            border-radius: 4px;
            border: 1px solid var(--grey-mid);
            white-space: nowrap;
        }

        .counter-label {
            font-size: clamp(0.65rem, 2vw, 0.8rem);
            color: var(--grey-mid);
            text-transform: uppercase;
        }

        .counter-value {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 700;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
            min-height: calc(100vh - 120px);
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }
        }

        @media (max-width: 640px) {
            header {
                padding: 0.8rem 1rem;
            }

            .container {
                padding: 0.8rem;
                gap: 0.8rem;
            }
        }

        .onboarding-section {
            background-color: var(--grey-dark);
            padding: 1.5rem;
            border-radius: 4px;
            border-left: 4px solid var(--white);
            margin-bottom: 1rem;
        }

        @media (max-width: 640px) {
            .onboarding-section {
                padding: 1rem;
                margin-bottom: 0.8rem;
            }
        }

        .onboarding-title {
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--white);
        }

        .onboarding-text {
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            color: var(--grey-light);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .onboarding-highlight {
            background-color: var(--black);
            padding: 1rem;
            border-left: 3px solid var(--white);
            border-radius: 3px;
            margin-bottom: 1rem;
            font-style: italic;
            font-size: clamp(0.85rem, 2.5vw, 0.95rem);
        }

        .game-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        @media (max-width: 640px) {
            .game-section {
                gap: 1rem;
            }
        }

        .section-title {
            font-size: clamp(0.9rem, 3vw, 1rem);
            font-weight: 600;
            color: var(--white);
            border-bottom: 2px solid var(--grey-dark);
            padding-bottom: 0.3rem;
        }

        .profile-input {
            padding: 1rem;
            background-color: var(--grey-dark);
            border-radius: 4px;
            border-left: 4px solid var(--white);
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        @media (max-width: 640px) {
            .profile-input {
                padding: 0.8rem;
                gap: 0.6rem;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-label {
            font-weight: 500;
            font-size: clamp(0.85rem, 2.5vw, 0.9rem);
        }

        select {
            padding: 0.7rem;
            background-color: var(--black);
            border: 1px solid var(--grey-mid);
            color: var(--white);
            font-family: var(--font-family);
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            border-radius: 4px;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5rem;
            padding-right: 2.5rem;
        }

        select:focus {
            outline: none;
            border-color: var(--white);
        }

        select option {
            background-color: var(--grey-dark);
            color: var(--white);
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
        }

        @media (max-width: 640px) {
            .controls {
                grid-template-columns: 1fr;
                gap: 0.6rem;
            }
        }

        .btn {
            padding: clamp(0.6rem, 2vw, 0.8rem) clamp(1rem, 3vw, 1.5rem);
            background-color: var(--white);
            color: var(--black);
            border: none;
            border-radius: 4px;
            font-weight: 600;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: var(--font-family);
        }

        .btn:hover, .btn:active {
            background-color: var(--grey-light);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background-color: var(--grey-dark);
            color: var(--white);
            border: 1px solid var(--grey-mid);
        }

        .btn.secondary:hover {
            background-color: var(--grey-mid);
        }

        .game-board {
            padding: 1.5rem;
            background-color: var(--grey-dark);
            border-radius: 4px;
            border: 2px solid var(--grey-mid);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        @media (max-width: 640px) {
            .game-board {
                padding: 1rem;
                min-height: auto;
            }
        }

        .game-board.hidden {
            display: none;
        }

        .progress-bar {
            display: flex;
            gap: 0.4rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        @media (max-width: 640px) {
            .progress-bar {
                gap: 0.3rem;
                margin-bottom: 1rem;
            }
        }

        .progress-dot {
            width: clamp(24px, 6vw, 30px);
            height: clamp(24px, 6vw, 30px);
            border-radius: 50%;
            background-color: var(--grey-dark);
            border: 2px solid var(--grey-mid);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(0.7rem, 2vw, 0.8rem);
            font-weight: 600;
            flex: 0 0 auto;
        }

        .progress-dot.active {
            background-color: var(--white);
            color: var(--black);
            border-color: var(--white);
        }

        .progress-dot.completed {
            background-color: var(--grey-mid);
            color: var(--white);
        }

        .scenario-box {
            background-color: var(--black);
            padding: 1.5rem;
            border-radius: 4px;
            border-left: 4px solid var(--white);
            margin-bottom: 1.5rem;
        }

        @media (max-width: 640px) {
            .scenario-box {
                padding: 1rem;
                margin-bottom: 1rem;
            }
        }

        .scenario-title {
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            color: var(--grey-light);
            text-transform: uppercase;
            margin-bottom: 0.8rem;
            letter-spacing: 0.05em;
        }

        .scenario-text {
            font-size: clamp(0.95rem, 2.5vw, 1rem);
            color: var(--white);
            font-weight: 500;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .scenario-explanation {
            font-size: clamp(0.8rem, 2.5vw, 0.85rem);
            color: var(--grey-light);
            background-color: var(--grey-dark);
            padding: 0.8rem;
            border-radius: 3px;
            border-left: 3px solid #cfcfcf;
            line-height: 1.4;
        }

        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 640px) {
            .choices {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
        }

        .choice-btn {
            padding: clamp(0.8rem, 3vw, 1rem);
            background-color: var(--white);
            color: var(--black);
            border: 2px solid var(--white);
            border-radius: 4px;
            font-weight: 600;
            font-size: clamp(0.85rem, 2.5vw, 0.9rem);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
        }

        @media (max-width: 640px) {
            .choice-btn {
                min-height: 60px;
                padding: 0.6rem;
            }
        }

        .choice-btn:active {
            transform: scale(0.98);
        }

        .choice-btn.risky {
            border-color: #ff6b6b;
            color: #ff6b6b;
            background-color: var(--black);
        }

        .choice-btn.risky:active {
            background-color: #ff6b6b;
            color: var(--black);
        }

        .choice-btn.safe {
            border-color: #51cf66;
            color: #51cf66;
            background-color: var(--black);
        }

        .choice-btn.safe:active {
            background-color: #51cf66;
            color: var(--black);
        }

        .privacy-note {
            font-size: clamp(0.65rem, 2vw, 0.7rem);
            color: var(--grey-mid);
            padding: 0.8rem;
            border-top: 1px dashed var(--grey-dark);
            text-align: center;
        }

        .results {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        @media (max-width: 640px) {
            .results {
                gap: 1rem;
            }
        }

        .results.hidden {
            display: none;
        }

        .user-info {
            padding: 1.5rem;
            background-color: var(--grey-dark);
            border-radius: 4px;
            border-left: 4px solid var(--white);
        }

        @media (max-width: 640px) {
            .user-info {
                padding: 1rem;
            }
        }

        .user-info-title {
            font-size: clamp(0.8rem, 2.5vw, 0.85rem);
            color: var(--grey-mid);
            text-transform: uppercase;
            margin-bottom: 0.8rem;
        }

        .user-info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--grey-dark);
            font-size: clamp(0.85rem, 2.5vw, 0.9rem);
        }

        .user-info-item:last-child {
            border-bottom: none;
        }

        .user-label {
            color: var(--grey-light);
            font-weight: 500;
        }

        .user-value {
            color: var(--white);
            font-weight: 600;
        }

        .gauge-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
            padding: 1.5rem;
            background-color: var(--grey-dark);
            border-radius: 4px;
        }

        @media (max-width: 640px) {
            .gauge-container {
                padding: 1rem;
                gap: 0.6rem;
            }
        }

        .gauge-title {
            font-size: clamp(0.75rem, 2.5vw, 0.8rem);
            color: var(--grey-mid);
            text-transform: uppercase;
        }

        .gauge-svg {
            width: 100%;
            max-width: 240px;
            height: auto;
        }

        .gauge-score {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 700;
        }

        .gauge-category {
            font-size: clamp(0.85rem, 2.5vw, 0.95rem);
            color: var(--grey-light);
            font-weight: 500;
        }

        .gauge-message {
            font-size: clamp(0.8rem, 2.5vw, 0.85rem);
            color: var(--grey-light);
            text-align: center;
            line-height: 1.5;
            margin-top: 0.8rem;
            padding: 0.8rem;
            background-color: var(--black);
            border-radius: 4px;
            border-left: 3px solid var(--white);
        }

        .simulation-container {
            padding: 1.5rem;
            background-color: var(--grey-dark);
            border-radius: 4px;
        }

        @media (max-width: 640px) {
            .simulation-container {
                padding: 1rem;
            }
        }

        .simulation-title {
            font-size: clamp(0.75rem, 2.5vw, 0.8rem);
            color: var(--grey-mid);
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        .radial-bars {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            gap: 0.4rem;
            min-height: 140px;
        }

        @media (max-width: 640px) {
            .radial-bars {
                min-height: 120px;
                gap: 0.3rem;
            }
        }

        .radial-bar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            flex: 1;
        }

        .radial-bar-svg {
            width: 100%;
            height: 120px;
        }

        @media (max-width: 640px) {
            .radial-bar-svg {
                height: 100px;
            }
        }

        .radial-bar-label {
            font-size: clamp(0.6rem, 2vw, 0.65rem);
            color: var(--grey-mid);
        }

        .interventions-container {
            padding: 1.5rem;
            background-color: var(--grey-dark);
            border-radius: 4px;
        }

        @media (max-width: 640px) {
            .interventions-container {
                padding: 1rem;
            }
        }

        .interventions-title {
            font-size: clamp(0.75rem, 2.5vw, 0.8rem);
            color: var(--grey-mid);
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        .intervention-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.6rem;
        }

        @media (max-width: 640px) {
            .intervention-buttons {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }

        .btn-intervention {
            padding: 0.6rem;
            font-size: clamp(0.7rem, 2vw, 0.75rem);
            background-color: var(--grey-dark);
            color: var(--white);
            border: 1px solid var(--grey-mid);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: var(--font-family);
            font-weight: 600;
        }

        .btn-intervention:active {
            background-color: var(--grey-mid);
            transform: scale(0.98);
        }

        .intervention-feedback {
            margin-top: 1rem;
            padding: 0.8rem;
            background-color: var(--black);
            border-left: 3px solid var(--white);
            border-radius: 2px;
            font-size: clamp(0.75rem, 2.5vw, 0.8rem);
            color: var(--grey-light);
            display: none;
        }

        .intervention-feedback.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .contributors-container {
            padding: 1.5rem;
            background-color: var(--grey-dark);
            border-radius: 4px;
        }

        @media (max-width: 640px) {
            .contributors-container {
                padding: 1rem;
            }
        }

        .contributors-title {
            font-size: clamp(0.75rem, 2.5vw, 0.8rem);
            color: var(--grey-mid);
            text-transform: uppercase;
            margin-bottom: 0.8rem;
        }

        .contributor-item {
            padding: 0.6rem;
            margin-bottom: 0.6rem;
            background-color: var(--black);
            border-left: 3px solid var(--white);
            border-radius: 2px;
            font-size: clamp(0.8rem, 2.5vw, 0.85rem);
        }

        @media (max-width: 640px) {
            .contributor-item {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            header {
                flex-direction: column;
                text-align: center;
                padding: 0.7rem 0.8rem;
            }

            .header-content {
                width: 100%;
            }

            .people-counter {
                width: 100%;
                justify-content: center;
            }

            h1 {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>ðŸŽ® Feed Loop Quest</h1>
            <p class="subtitle">Explore algorithmic bias through gameplay</p>
        </div>
        <div class="people-counter">
            <span class="counter-label">Players</span>
            <span class="counter-value" id="peopleCount">0</span>
        </div>
    </header>

    <div class="container">
        <div class="game-section" id="gameSection">
            <div class="onboarding-section" id="onboardingSection">
                <div class="onboarding-title">ðŸ“Š Participate in an Experiment</div>
                <div class="onboarding-text">
                    You are invited to participate in an experiment exploring <strong>algorithmic bias in social media</strong>. 
                </div>
                <div class="onboarding-highlight">
                    ðŸ’¡ This involves reflecting on your own social media viewing patterns from the <strong>past 7 days</strong>, 
                    or you can track your patterns <strong>during this exhibition</strong> and complete the quest later.
                </div>
                <div class="onboarding-text">
                    Answer questions based on your actual SNS (Social Network Service) habits to discover how much your feed is shaped by algorithmic feedback loops. 
                    <strong>No personal data is collectedâ€”it's all anonymous and local to your device.</strong>
                </div>
            </div>

            <div>
                <h2 class="section-title">Create Your Profile</h2>
                <div class="profile-input">
                    <div class="input-group">
                        <label class="input-label">Profession:</label>
                        <select id="profession">
                            <option value="">-- Select --</option>
                            <option value="student">Student</option>
                            <option value="designer">Designer</option>
                            <option value="developer">Developer</option>
                            <option value="marketer">Marketer</option>
                            <option value="educator">Educator</option>
                            <option value="artist">Artist/Creator</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Platform:</label>
                        <select id="platform">
                            <option value="">-- Select --</option>
                            <option value="youtube">YouTube</option>
                            <option value="tiktok">TikTok</option>
                            <option value="instagram">Instagram</option>
                            <option value="facebook">Facebook</option>
                            <option value="twitter">Twitter/X</option>
                            <option value="linkedin">LinkedIn</option>
                            <option value="reddit">Reddit</option>
                            <option value="twitch">Twitch</option>
                        </select>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn" id="startBtn">Start Quest</button>
                    <button class="btn secondary" id="resetBtn">Reset</button>
                </div>
            </div>

            <div class="game-board hidden" id="gameBoard">
                <div class="progress-bar" id="progressBar"></div>
                <div class="scenario-box">
                    <div class="scenario-title" id="scenarioNumber"></div>
                    <div class="scenario-text" id="scenarioText"></div>
                    <div class="scenario-explanation" id="scenarioExplanation"></div>
                </div>
                <div class="choices" id="choices"></div>
            </div>

            <div class="privacy-note">
                ðŸ”’ Privacy First: No data leaves your browser. All computation is 100% local and anonymous.
            </div>
        </div>

        <div class="results hidden" id="results">
            <div class="user-info">
                <div class="user-info-title">Your Profile</div>
                <div class="user-info-item">
                    <span class="user-label">Profession:</span>
                    <span class="user-value" id="professionDisplay">â€”</span>
                </div>
                <div class="user-info-item">
                    <span class="user-label">Platform:</span>
                    <span class="user-value" id="platformDisplay">â€”</span>
                </div>
            </div>

            <div class="gauge-container">
                <div class="gauge-title">Your Loop Strength</div>
                <svg class="gauge-svg" viewBox="0 0 280 200">
                    <defs>
                        <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#888888;stop-opacity:0.3" />
                            <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0.8" />
                        </linearGradient>
                    </defs>
                    <path d="M 50 150 A 100 100 0 0 1 230 150" fill="none" stroke="#333333" stroke-width="8" stroke-linecap="round" />
                    <path id="gaugeFill" d="M 50 150 A 100 100 0 0 1 230 150" fill="none" stroke="url(#gaugeGradient)" stroke-width="8" stroke-linecap="round" stroke-dasharray="0 314" />
                    <text x="45" y="165" font-size="12" fill="#888888" text-anchor="middle">0</text>
                    <text x="140" y="30" font-size="12" fill="#888888" text-anchor="middle">50</text>
                    <text x="235" y="165" font-size="12" fill="#888888" text-anchor="middle">100</text>
                </svg>
                <div class="gauge-score" id="scoreDisplay">0</div>
                <div class="gauge-category" id="categoryDisplay">â€”</div>
                <div class="gauge-message" id="gaugeMessage"></div>
            </div>

            <div class="interventions-container">
                <div class="interventions-title">Try an Intervention</div>
                <div class="intervention-buttons">
                    <button class="btn-intervention" id="diversifyBtn">Diversify</button>
                    <button class="btn-intervention" id="clearHistoryBtn">Clear History</button>
                    <button class="btn-intervention" id="followSmallBtn">Follow New</button>
                </div>
                <div id="interventionFeedback" class="intervention-feedback"></div>
            </div>

            <div class="simulation-container">
                <div class="simulation-title">Loop Strength Over 7 Days</div>
                <div class="radial-bars" id="radialBars"></div>
            </div>

            <div class="contributors-container">
                <div class="contributors-title">Your Risky Choices</div>
                <div id="contributorsList"></div>
            </div>

            <button class="btn" id="restartBtn">Play Again</button>
        </div>
    </div>

    <script>
        const scenarios = [
            {
                title: "Scenario 1: Search Rebound Effect",
                text: "You search for 'gardening tips' (a new topic). The algorithm immediately shows you mostly tech content again (your usual interest). What do you do?",
                explanation: "This tests if the algorithm pulls you back to familiar content when you try to explore something new.",
                choices: [
                    { text: "Accept tech content - it's what I usually watch", risky: true, points: 20 },
                    { text: "Scroll down to find gardening content instead", risky: false, points: 0 }
                ]
            },
            {
                title: "Scenario 2: Creator Dominance",
                text: "One creator (e.g., a YouTuber) keeps appearing in your recommendations multiple times per day. Their videos are interesting. Do you:",
                explanation: "This measures if you recognize when one source dominates your feed (a sign of algorithmic narrowing).",
                choices: [
                    { text: "Keep watching - they're entertaining", risky: true, points: 20 },
                    { text: "Actively search for and watch other creators", risky: false, points: 0 }
                ]
            },
            {
                title: "Scenario 3: Emotional Triggering",
                text: "You notice certain types of content (drama, politics, controversy) always appear in your feed and trigger strong emotional reactions (anger, anxiety, excitement). Do you:",
                explanation: "Algorithms often promote emotionally engaging content because it increases engagement. This tests your awareness.",
                choices: [
                    { text: "Continue watching - emotions feel real", risky: true, points: 20 },
                    { text: "Deliberately seek calming or neutral content", risky: false, points: 0 }
                ]
            },
            {
                title: "Scenario 4: Feed Narrowing Over Time",
                text: "Looking back at your feed from a week ago vs today, you notice it's showing fewer diverse topics and mostly repeating the same themes. Do you:",
                explanation: "This detects if you notice the algorithmic loop tightening around your interests over time.",
                choices: [
                    { text: "Accept it - the algorithm knows my preferences", risky: true, points: 20 },
                    { text: "Clear your watch history and search for new topics", risky: false, points: 0 }
                ]
            },
            {
                title: "Scenario 5: Creator Diversity",
                text: "You realize your feed is mostly filled with large, verified creators and celebrities. Small, independent creators rarely appear. Do you:",
                explanation: "Algorithms may favor large accounts because they're safer/more popular. This tests awareness of this bias.",
                choices: [
                    { text: "Trust verified creators - they're reliable", risky: true, points: 20 },
                    { text: "Actively search for and follow small independent creators", risky: false, points: 0 }
                ]
            }
        ];

        let currentScore = 0;
        let currentScenario = 0;
        let currentProfession = "";
        let currentPlatform = "";
        let currentHistory = [];
        let peopleCount = localStorage.getItem('peopleCount') ? parseInt(localStorage.getItem('peopleCount')) : 0;

        function getCategory(score) {
            if (score >= 81) return 'Very High';
            if (score >= 61) return 'High';
            if (score >= 41) return 'Moderate';
            if (score >= 21) return 'Low';
            return 'Very Low';
        }

        function getLoopMessage(score) {
            if (score === 0) {
                return "ðŸŽ‰ Excellent! You have complete control. You actively diversify and resist algorithms. Keep it up!";
            } else if (score <= 20) {
                return "âœ… Great! Strong control on your loop. Your choices show awareness. Congratulations!";
            } else if (score <= 40) {
                return "ðŸ“Š Good balance. Moderately affected but making conscious choices. Keep exploring!";
            } else if (score <= 60) {
                return "âš ï¸ Moderate loop detected. Algorithm has influence. Clear history and diversify to break the pattern.";
            } else if (score <= 80) {
                return "ðŸ”´ Strong loop! Feed is narrowing. Diversify aggressively and follow new creators now.";
            } else {
                return "ðŸš¨ Very strong loop! Heavily trapped. Take action: clear history, diversify, follow independents!";
            }
        }

        function getProfessionLabel(value) {
            const labels = {
                'student': 'Student', 'designer': 'Designer', 'developer': 'Developer',
                'marketer': 'Marketer', 'educator': 'Educator', 'artist': 'Artist/Creator', 'other': 'Other'
            };
            return labels[value] || 'Not specified';
        }

        function getPlatformLabel(value) {
            const labels = {
                'youtube': 'YouTube', 'tiktok': 'TikTok', 'instagram': 'Instagram', 'facebook': 'Facebook',
                'twitter': 'Twitter/X', 'linkedin': 'LinkedIn', 'reddit': 'Reddit', 'twitch': 'Twitch'
            };
            return labels[value] || 'Not specified';
        }

        function renderScenario() {
            const scenario = scenarios[currentScenario];
            document.getElementById('scenarioNumber').textContent = `Question ${currentScenario + 1} / ${scenarios.length}`;
            document.getElementById('scenarioText').textContent = scenario.text;
            document.getElementById('scenarioExplanation').textContent = `ðŸ’¡ Why: ${scenario.explanation}`;

            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            scenario.choices.forEach((choice) => {
                const btn = document.createElement('button');
                btn.className = `choice-btn ${choice.risky ? 'risky' : 'safe'}`;
                btn.textContent = choice.text;
                btn.addEventListener('click', () => selectChoice(choice.points));
                choicesDiv.appendChild(btn);
            });

            renderProgressBar();
        }

        function renderProgressBar() {
            const progressDiv = document.getElementById('progressBar');
            progressDiv.innerHTML = '';
            for (let i = 0; i < scenarios.length; i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (i < currentScenario) {
                    dot.className += ' completed';
                } else if (i === currentScenario) {
                    dot.className += ' active';
                }
                dot.textContent = i + 1;
                progressDiv.appendChild(dot);
            }
        }

        function selectChoice(points) {
            currentScore += points;
            currentScenario++;

            if (currentScenario < scenarios.length) {
                renderScenario();
            } else {
                finishGame();
            }
        }

        function simulateHistory(score) {
            const history = [];
            for (let day = 1; day <= 7; day++) {
                if (day === 7) {
                    history.push(score);
                } else {
                    const decay = (7 - day) * Math.floor(Math.random() * 8);
                    history.push(Math.max(0, score - decay));
                }
            }
            return history;
        }

        function animateValue(element, start, end, duration = 1000) {
            const startTime = performance.now();
            const animate = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const value = Math.round(start + (end - start) * progress);
                element.textContent = value;
                if (progress < 1) requestAnimationFrame(animate);
            };
            requestAnimationFrame(animate);
        }

        function animateGauge(score) {
            const gaugeElement = document.getElementById('gaugeFill');
            const totalLength = 314;
            const percentage = score / 100;
            const filledLength = totalLength * percentage;
            const startTime = performance.now();
            const duration = 1500;

            const animate = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentLength = filledLength * progress;
                gaugeElement.setAttribute('stroke-dasharray', `${currentLength} ${totalLength}`);
                if (progress < 1) requestAnimationFrame(animate);
            };
            requestAnimationFrame(animate);
        }

        function drawRadialBars(history) {
            const container = document.getElementById('radialBars');
            container.innerHTML = '';
            history.forEach((value, index) => {
                const heightPercent = (value / 100) * 100;
                const item = document.createElement('div');
                item.className = 'radial-bar-item';
                const svg = `
                    <svg class="radial-bar-svg" viewBox="0 0 40 140">
                        <rect x="12" y="10" width="16" height="120" fill="none" stroke="#333333" stroke-width="2" rx="2" />
                        <rect x="12" y="${140 - (120 * heightPercent / 100)}" width="16" height="${120 * heightPercent / 100}" fill="#ffffff" opacity="0.7" rx="2" />
                        <text x="20" y="135" font-size="10" fill="#888888" text-anchor="middle">${Math.round(value)}</text>
                    </svg>
                    <div class="radial-bar-label">D${index + 1}</div>
                `;
                item.innerHTML = svg;
                container.appendChild(item);
            });
        }

        function drawContributors() {
            const container = document.getElementById('contributorsList');
            const riskyChoices = ['Stayed with familiar', 'Watched same creator', 'Engaged emotions', 'Accepted narrow', 'Used big accounts'];
            container.innerHTML = '';
            if (currentScore === 0) {
                container.innerHTML = '<div style="color: var(--grey-mid);">Safe choices! Low loop strength.</div>';
                return;
            }
            const numChoices = Math.ceil(currentScore / 20);
            for (let i = 0; i < numChoices && i < 5; i++) {
                const item = document.createElement('div');
                item.className = 'contributor-item';
                item.innerHTML = `âš ï¸ ${riskyChoices[i]}`;
                container.appendChild(item);
            }
        }

        function finishGame() {
            currentScore = Math.min(currentScore, 100);
            document.getElementById('gameSection').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');

            document.getElementById('professionDisplay').textContent = getProfessionLabel(currentProfession);
            document.getElementById('platformDisplay').textContent = getPlatformLabel(currentPlatform);

            animateGauge(currentScore);
            animateValue(document.getElementById('scoreDisplay'), 0, currentScore, 1500);
            setTimeout(() => {
                document.getElementById('categoryDisplay').textContent = getCategory(currentScore);
                document.getElementById('gaugeMessage').textContent = getLoopMessage(currentScore);
            }, 500);

            currentHistory = simulateHistory(currentScore);
            drawRadialBars(currentHistory);
            drawContributors();

            peopleCount++;
            localStorage.setItem('peopleCount', peopleCount);
            document.getElementById('peopleCount').textContent = peopleCount;
        }

        function applyIntervention(reduction, label) {
            let newScore = Math.max(0, currentScore - reduction);
            newScore = Math.min(newScore, 100);

            const feedback = document.getElementById('interventionFeedback');
            feedback.textContent = `âœ“ ${label} - Reduced by ${reduction} pts!`;
            feedback.classList.add('show');

            document.getElementById('scoreDisplay').textContent = newScore;
            document.getElementById('categoryDisplay').textContent = getCategory(newScore);
            document.getElementById('gaugeMessage').textContent = getLoopMessage(newScore);
            animateGauge(newScore);

            currentHistory = simulateHistory(newScore);
            drawRadialBars(currentHistory);
            currentScore = newScore;

            setTimeout(() => feedback.classList.remove('show'), 3000);
        }

        document.getElementById('startBtn').addEventListener('click', () => {
            const prof = document.getElementById('profession').value;
            const plat = document.getElementById('platform').value;
            if (!prof || !plat) {
                alert('Please select profession and platform!');
                return;
            }
            currentProfession = prof;
            currentPlatform = plat;
            currentScore = 0;
            currentScenario = 0;
            document.getElementById('gameBoard').classList.remove('hidden');
            document.getElementById('onboardingSection').scrollIntoView({ behavior: 'smooth' });
            renderScenario();
        });

        document.getElementById('resetBtn').addEventListener('click', () => location.reload());
        document.getElementById('restartBtn').addEventListener('click', () => location.reload());
        document.getElementById('diversifyBtn').addEventListener('click', () => applyIntervention(15, 'Diversify'));
        document.getElementById('clearHistoryBtn').addEventListener('click', () => applyIntervention(25, 'Clear History'));
        document.getElementById('followSmallBtn').addEventListener('click', () => applyIntervention(10, 'Follow New'));

        document.getElementById('peopleCount').textContent = peopleCount;
    </script>
</body>
</html>
